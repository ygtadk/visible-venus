---
import {
  getLangFromUrl,
  useTranslations,
} from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const services = [
  {
    icon: "üöÄ",
    titleKey: "services.web.title",
    descKey: "services.web.desc",
    color: "from-blue-500 to-blue-600",
  },
  {
    icon: "üîß",
    titleKey: "services.software.title",
    descKey: "services.software.desc",
    color: "from-purple-500 to-purple-600",
  },
  {
    icon: "‚òÅÔ∏è",
    titleKey: "services.cloud.title",
    descKey: "services.cloud.desc",
    color: "from-cyan-500 to-cyan-600",
  },
  {
    icon: "üìä",
    titleKey: "services.consulting.title",
    descKey: "services.consulting.desc",
    color: "from-orange-500 to-orange-600",
  },
  {
    icon: "üîí",
    titleKey: "services.security.title",
    descKey: "services.security.desc",
    color: "from-red-500 to-red-600",
  },
  {
    icon: "üì±",
    titleKey: "services.mobile.title",
    descKey: "services.mobile.desc",
    color: "from-green-500 to-green-600",
  },
];
---

<!-- Services Section with Infinite Scroll -->
<section id="services-scroll" class="relative w-full min-h-screen bg-neutral-950 overflow-hidden">
  <!-- Left Progress Bar - Vertical Segments -->
  <div class="fixed left-0 top-0 h-full flex flex-col z-50">
    {services.map((_, index) => (
      <div
        class="service-indicator flex-1 w-1 bg-neutral-800 hover:w-3 hover:bg-green-400 cursor-pointer transition-all duration-300"
        data-index={index}
        title={`Service ${index + 1}`}>
      </div>
    ))}
  </div>

  <!-- Services Container -->
  <div id="services-container" class="relative w-full">
    {services.map((service, index) => (
      <div
        class={`service-slide w-full min-h-screen flex items-center justify-center bg-linear-to-br ${service.color} overflow-hidden`}
        data-index={index}>
        <!-- Animated Background Elements -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute top-10 left-10 w-72 h-72 bg-white rounded-full blur-3xl"></div>
          <div class="absolute bottom-10 right-10 w-96 h-96 bg-white rounded-full blur-3xl"></div>
        </div>

        <!-- Content -->
        <div class="relative z-10 max-w-3xl mx-auto px-8 text-center">
          <div class="text-9xl mb-8 service-slide-icon">{service.icon}</div>
          <h2 class="text-5xl md:text-6xl font-bold text-white mb-6">
            {t(service.titleKey)}
          </h2>
          <p class="text-xl md:text-2xl text-white/90 leading-relaxed mb-8">
            {t(service.descKey)}
          </p>
          <div class="flex items-center justify-center gap-4">
            <div class="h-1 w-12 bg-white/40"></div>
            <p class="text-sm md:text-base text-white/70 font-medium">
              {index + 1} / {services.length}
            </p>
            <div class="h-1 w-12 bg-white/40"></div>
          </div>
        </div>

        <!-- Scroll Indicator -->
        {index < services.length - 1 && (
          <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20">
            <div class="scroll-indicator text-white/60 text-center">
              <div class="text-sm font-medium mb-2">A≈üaƒüƒ± Kaydƒ±r</div>
              <svg class="w-6 h-6 mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
              </svg>
            </div>
          </div>
        )}
      </div>
    ))}
  </div>

  <!-- Navigation Buttons -->
  <div class="fixed bottom-8 right-8 z-40 flex gap-4">
    <button
      id="prev-service"
      class="p-3 rounded-full bg-neutral-800 hover:bg-neutral-700 text-white transition-colors"
      aria-label="Previous service">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <button
      id="next-service"
      class="p-3 rounded-full bg-neutral-800 hover:bg-neutral-700 text-white transition-colors"
      aria-label="Next service">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</section>
        <!-- Animated Background Elements -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute top-10 left-10 w-72 h-72 bg-white rounded-full blur-3xl"></div>
          <div class="absolute bottom-10 right-10 w-96 h-96 bg-white rounded-full blur-3xl"></div>
        </div>

        <!-- Content -->
        <div class="relative z-10 max-w-3xl mx-auto px-8 text-center">
          <div class="text-9xl mb-8 service-slide-icon">{service.icon}</div>
          <h2 class="text-5xl md:text-6xl font-bold text-white mb-6">
            {t(service.titleKey)}
          </h2>
          <p class="text-xl md:text-2xl text-white/90 leading-relaxed mb-8">
            {t(service.descKey)}
          </p>
          <div class="flex items-center justify-center gap-4">
            <div class="h-1 w-12 bg-white/40"></div>
            <p class="text-sm md:text-base text-white/70 font-medium">
              {index + 1} / {services.length}
            </p>
            <div class="h-1 w-12 bg-white/40"></div>
          </div>
        </div>

        <!-- Scroll Indicator -->
        {index < services.length - 1 && (
          <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20">
            <div class="scroll-indicator text-white/60 text-center">
              <div class="text-sm font-medium mb-2">A≈üaƒüƒ± Kaydƒ±r</div>
              <svg class="w-6 h-6 mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
              </svg>
            </div>
          </div>
        )}
      </div>
    ))}
  </div>

  <!-- Navigation Buttons -->
  <div class="fixed bottom-8 right-8 z-40 flex gap-4">
    <button
      id="prev-service"
      class="p-3 rounded-full bg-neutral-800 hover:bg-neutral-700 text-white transition-colors"
      aria-label="Previous service">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <button
      id="next-service"
      class="p-3 rounded-full bg-neutral-800 hover:bg-neutral-700 text-white transition-colors"
      aria-label="Next service">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</section>

<script>
  import { gsap } from 'gsap';

  const SERVICES_COUNT = 6;
  let currentService = 0;
  let isAnimating = false;
  let wheelTimeout: ReturnType<typeof setTimeout> | undefined;
  const totalHeight = SERVICES_COUNT * 100;

  const container = document.getElementById('services-container') as HTMLDivElement;
  const progressBar = document.getElementById('progress-bar') as HTMLDivElement;
  const indicators = document.querySelectorAll('.service-indicator') as NodeListOf<HTMLDivElement>;
  const slides = document.querySelectorAll('.service-slide') as NodeListOf<HTMLDivElement>;
  const prevBtn = document.getElementById('prev-service') as HTMLButtonElement;
  const nextBtn = document.getElementById('next-service') as HTMLButtonElement;

  function updateUI() {
    // Update progress bar
    const progress = ((currentService + 1) / SERVICES_COUNT) * 100;
    gsap.to(progressBar, {
      height: `${progress}%`,
      duration: 0.6,
      ease: 'power2.inOut',
    });

    // Update indicators
    indicators.forEach((indicator, index) => {
      if (index === currentService) {
        indicator.classList.add('border-green-400', 'bg-green-400', 'text-neutral-900');
        indicator.classList.remove('border-neutral-700', 'bg-neutral-900', 'text-neutral-400');
      } else {
        indicator.classList.remove('border-green-400', 'bg-green-400', 'text-neutral-900');
        indicator.classList.add('border-neutral-700', 'bg-neutral-900', 'text-neutral-400');
      }
    });

    // Animate icons
    slides.forEach((slide, index) => {
      const icon = slide.querySelector('.service-slide-icon') as HTMLDivElement;
      if (index === currentService) {
        gsap.to(icon, {
          scale: 1,
          opacity: 1,
          duration: 0.6,
          ease: 'back.out',
        });
      }
    });
  }

  function goToService(index: number) {
    if (isAnimating || index === currentService) return;
    if (index < 0 || index >= SERVICES_COUNT) return;

    isAnimating = true;
    currentService = index;

    // Animate container
    gsap.to(container, {
      y: -currentService * window.innerHeight,
      duration: 0.8,
      ease: 'power3.inOut',
      onComplete: () => {
        isAnimating = false;
      },
    });

    updateUI();
  }

  function nextService() {
    const nextIndex = (currentService + 1) % SERVICES_COUNT;
    goToService(nextIndex);
  }

  function prevService() {
    const prevIndex = (currentService - 1 + SERVICES_COUNT) % SERVICES_COUNT;
    goToService(prevIndex);
  }

  // Event Listeners
  prevBtn?.addEventListener('click', prevService);
  nextBtn?.addEventListener('click', nextService);

  // Indicator clicks
  indicators.forEach((indicator) => {
    indicator.addEventListener('click', () => {
      const index = parseInt((indicator as HTMLDivElement).dataset.index || '0');
      goToService(index);
    });
  });

  // Wheel scroll
  document.addEventListener('wheel', (e) => {
    const section = document.getElementById('services-scroll');
    if (section && section.getBoundingClientRect().top <= 0) {
      e.preventDefault();
      clearTimeout(wheelTimeout);
      wheelTimeout = setTimeout(() => {
        if (e.deltaY > 0) {
          nextService();
        } else {
          prevService();
        }
      }, 50);
    }
  }, { passive: false });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    const section = document.getElementById('services-scroll');
    if (section && section.getBoundingClientRect().top <= 0) {
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        nextService();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        prevService();
      }
    }
  });

  // Initialize
  updateUI();
</script>

<style>
  #services-scroll {
    scroll-behavior: smooth;
  }

  .service-slide {
    will-change: transform;
  }

  .scroll-indicator {
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
</style>

<!-- End Services -->