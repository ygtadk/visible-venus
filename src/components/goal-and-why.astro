---
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { Icon } from "astro-icon/components";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const whyTexts = t("why.text") as unknown as string[];
---

<section class="bg-neutral-900 py-24">
  <div class="mx-auto max-w-7xl px-4 xl:px-0">
    <!-- Arrow Animation Container -->
    <div class="mb-12 flex justify-center">
      <svg id="scroll-arrow" width="60" height="150" viewBox="0 0 60 150" fill="none" xmlns="http://www.w3.org/2000/svg" class="stroke-green-400 stroke-3">
        <path d="M30 0 V140 M30 140 L10 110 M30 140 L50 110" class="arrow-path" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </div>

    <div class="grid grid-cols-1 gap-16 lg:grid-cols-2 lg:gap-24">
      <!-- Why Us Section -->
      <div class="lg:col-span-2 lg:mt-32">
        <div class="mx-auto max-w-3xl ">
          <h2 class="mb-6 text-center text-3xl font-bold tracking-widest text-green-400 uppercase">{t("why.title")}</h2>
          <ul class="space-y-8">
            {
              whyTexts.map((text) => (
                <li class="why-item flex translate-y-8 items-start gap-6 opacity-0">
                  <div class="mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full bg-green-400/10 text-green-400 shadow-[0_0_15px_rgba(74,222,128,0.2)]">
                    <Icon name="solar:check-circle-bold" class="h-5 w-5" />
                  </div>
                  <p class="text-xl leading-relaxed text-neutral-300">{text}</p>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // Arrow Animation
  const arrowPath = document.querySelector(".arrow-path");
  if (arrowPath) {
    const length = (arrowPath as SVGPathElement).getTotalLength();
    gsap.set(arrowPath, { strokeDasharray: length, strokeDashoffset: length });

    gsap.to(arrowPath, {
      strokeDashoffset: 0,
      duration: 3,
      scrollTrigger: {
        trigger: "#scroll-arrow",
        start: "top 50%",
        end: "bottom 10%",
        scrub: 1,
      },
    });
  }

  // List Items Animation
  const items = document.querySelectorAll(".why-item");
  if (items.length > 0) {
    gsap.to(items, {
      opacity: 1,
      y: 0,
      duration: 0.8,
      stagger: 0.15,
      ease: "power3.out",
      scrollTrigger: {
        trigger: items[0],
        start: "top 85%",
        toggleActions: "play none none reverse",
      },
    });
  }
</script>
